# Copyright 2024 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# ============================================================================
# Team-Based RBAC Cluster Roles
# ============================================================================

# QA Team - Read-only access for testing and monitoring
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: team-viewer
  labels:
    rbac.authorization.k8s.io/team-role: viewer
    app.kubernetes.io/part-of: online-boutique
    app.kubernetes.io/component: team-rbac
  annotations:
    description: "Read-only access for QA and monitoring teams"
rules:
# Core resources - read only
- apiGroups: [""]
  resources: ["pods", "services", "endpoints", "configmaps", "secrets", "namespaces"]
  verbs: ["get", "list", "watch"]
# Apps resources - read only  
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets", "statefulsets", "daemonsets"]
  verbs: ["get", "list", "watch"]
# Networking resources - read only
- apiGroups: ["networking.k8s.io"]
  resources: ["ingresses", "networkpolicies"]
  verbs: ["get", "list", "watch"]
# Events for troubleshooting
- apiGroups: [""]
  resources: ["events"]
  verbs: ["get", "list", "watch"]
# Metrics access
- apiGroups: ["metrics.k8s.io"]
  resources: ["pods", "nodes"]
  verbs: ["get", "list"]

---
# Development Team - Edit access for development environments
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: team-editor
  labels:
    rbac.authorization.k8s.io/team-role: editor
    app.kubernetes.io/part-of: online-boutique
    app.kubernetes.io/component: team-rbac
  annotations:
    description: "Edit access for development teams"
rules:
# Core resources - full access
- apiGroups: [""]
  resources: ["pods", "services", "endpoints", "configmaps", "secrets"]
  verbs: ["get", "list", "watch", "create", "update", "patch"]
# Apps resources - full access
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets", "statefulsets", "daemonsets"]
  verbs: ["get", "list", "watch", "create", "update", "patch"]
# Networking resources - limited access
- apiGroups: ["networking.k8s.io"]
  resources: ["ingresses"]
  verbs: ["get", "list", "watch", "create", "update", "patch"]
# Events and logs
- apiGroups: [""]
  resources: ["events"]
  verbs: ["get", "list", "watch", "create"]
- apiGroups: [""]
  resources: ["pods/log", "pods/status"]
  verbs: ["get", "list"]
# Pod exec for debugging (limited)
- apiGroups: [""]
  resources: ["pods/exec"]
  verbs: ["create"]
# Port forwarding for debugging
- apiGroups: [""]
  resources: ["pods/portforward"]
  verbs: ["create"]

---
# DevOps Team - Administrative access for operations
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: team-admin
  labels:
    rbac.authorization.k8s.io/team-role: admin
    app.kubernetes.io/part-of: online-boutique
    app.kubernetes.io/component: team-rbac
  annotations:
    description: "Administrative access for DevOps teams"
rules:
# Full access to most application resources
- apiGroups: [""]
  resources: ["*"]
  verbs: ["*"]
- apiGroups: ["apps"]
  resources: ["*"]
  verbs: ["*"]
- apiGroups: ["networking.k8s.io"]
  resources: ["*"]
  verbs: ["*"]
- apiGroups: ["extensions"]
  resources: ["*"]
  verbs: ["*"]
# RBAC management (limited)
- apiGroups: ["rbac.authorization.k8s.io"]
  resources: ["roles", "rolebindings"]
  verbs: ["get", "list", "watch", "create", "update", "patch"]
# Metrics and monitoring
- apiGroups: ["metrics.k8s.io"]
  resources: ["*"]
  verbs: ["*"]

---
# Platform Team - Cluster-wide administrative access
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: team-platform
  labels:
    rbac.authorization.k8s.io/team-role: platform
    app.kubernetes.io/part-of: online-boutique
    app.kubernetes.io/component: team-rbac
  annotations:
    description: "Platform engineering - cluster-wide admin access"
rules:
# Cluster admin equivalent - full access to everything
- apiGroups: ["*"]
  resources: ["*"]
  verbs: ["*"]
# Non-resource URLs
- nonResourceURLs: ["*"]
  verbs: ["*"]